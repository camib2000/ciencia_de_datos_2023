<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Rayela - ETL</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="rayuela-etl_files/libs/clipboard/clipboard.min.js"></script>
<script src="rayuela-etl_files/libs/quarto-html/quarto.js"></script>
<script src="rayuela-etl_files/libs/quarto-html/popper.min.js"></script>
<script src="rayuela-etl_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="rayuela-etl_files/libs/quarto-html/anchor.min.js"></script>
<link href="rayuela-etl_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="rayuela-etl_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="rayuela-etl_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="rayuela-etl_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="rayuela-etl_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Rayela - ETL</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="rayuela" class="level2">
<h2 class="anchored" data-anchor-id="rayuela">Rayuela</h2>
<p>Tenemos el libro en formato PDF así que usamos el paquete correspondiente para extraer los datos en formato texto.</p>
<section id="instalación" class="level3">
<h3 class="anchored" data-anchor-id="instalación">Instalación</h3>
<p>Instalamos el paquete <em>pdftools</em> si no está instalado:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(pdftools)){</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"pdftools"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: pdftools</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Using poppler version 0.86.1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pdftools)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.2     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.0
✔ ggplot2   3.4.2     ✔ tibble    3.2.1
✔ lubridate 1.9.2     ✔ tidyr     1.3.0
✔ purrr     1.0.1     </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
</div>
<p>Intentamos cargar los datos</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>my_pdf_filename <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data/julio-cortazar-rayuela.pdf"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>my_pdf <span class="ot">&lt;-</span> pdftools<span class="sc">::</span><span class="fu">pdf_text</span>(my_pdf_filename)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(my_pdf, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Julio Cortazar\n  Rayuela\n"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
 [2] "Y animado de la esperanza de ser particularmente útil\na la juventud, y de contribuir a la reforma de las\ncostumbres en general, he formado la presente\ncolección de máximas, consejos y preceptos, que son\nla base de aquella moral universal, que es tan\nproporcionada a la felicidad espiritual y temporal de\ntodos los hombres de cualquiera edad, estado y\ncondición que sean, y a la prosperidad y buen orden,\nno sólo de la república civil y cristiana en que\nvivimos, sino de cualquiera otra república o gobierno\nque los filósofos más especulativos y profundos del\norbe quieran discurrir.\n                  Espíritu de la Biblia y Moral Universal,\n                 sacada del Antiguo y Nuevo Testamento.\n                Escrita en toscano por el abad Martini con\n                                            las citas al pie:\n                                 Traducida en castellano\n                Por un Clérigo Reglar de la Congregación\n                            de San Cayetano de esta Corte.\n                                              Con licencia.\n                                Madrid: Por Aznar, 1797.\n"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
 [3] "Siempre que biene el tiempo fresco, o sea al medio del otonio, a mí me da\nla loca de pensar ideas de tipo eséntrico y esótico, como ser por egenplo\nque me gustaría venirme golondrina para agarrar y volar a los paíx\nadonde haiga calor, o de ser hormiga para meterme bien adentro de una\ncueva y comer los productos guardados en el verano o de ser una bívora\ncomo las del solójico, que las tienen bien guardadas en una jaula de vidrio\ncon calefación para que no se queden duras de frío, que es lo que les pasa\na los pobres seres humanos que no pueden comprarse ropa con lo cara\nquestá, ni pueden calentarse por la falta del querosén, la falta del carbón,\nla falta de lenia, la falta de petrolio y tamién la falta de plata, porque\ncuando uno anda con biyuya ensima puede entrar a cualquier boliche y\nmandarse una buena grapa que hay que ver lo que calienta, aunque no\nconbiene abusar, porque del abuso entra el visio y del visio la dejeneradés\ntanto del cuerpo como de las taras moral de cada cual, y cuando se viene\nabajo por la pendiente fatal de la falta de buena condupta en todo sentido,\nya nadie ni nadies lo salva de acabar en el más espantoso tacho de basura\ndel desprastijio humano, y nunca le van a dar una mano para sacarlo de\nadentro del fango enmundo entre el cual se rebuelca, ni más ni meno que\nsi fuera un cóndor que cuando joven supo correr y volar por la punta de\nlas altas montanias, pero que al ser viejo cayó parabajo como bombardero\nen picada que le falia el motor moral. ¡Y ojalá que lo que estoy\nescribiendolé sirbalguno para que mire bien su comportamiento y que no\nsearrepienta cuando es tarde y ya todo se haiga ido al corno por culpa\nsuya!\n                                     CÉSAR BRUTO, Lo que me gustaría ser a mí\n                                    si no fuera lo que soy (capítulo: Perro de San\n                                                                        Bernardo).\n"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
 [4] "       DEL LADO DE ALLLA\nRien ne vous tue un homme comme d’être obligé de\nreprésenter un pays.\n    JACQUES VACHÉ, carta a André Breton.\n"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
 [5] "                                                                                    1\n                                                                                   1\n   ¿Encontraría a la Maga? Tantas veces me había bastado asomarme, viniendo\npor la rue de Seine, al arco que da al Quai de Conti, y apenas la luz de ceniza y\nolivo que flota sobre el río me dejaba distinguir las formas, ya su silueta delgada\nse inscribía en el Pont des Arts, a veces andando de un lado a otro, a veces\ndetenida en el pretil de hierro, inclinada sobre el agua. Y era tan natural cruzar la\ncalle, subir los peldaños del puente, entrar en su delgada cintura y acercarme a la\nMaga que sonreía sin sorpresa, convencida como yo de que un encuentro casual\nera lo menos casual en nuestras vidas, y que la gente que se da citas precisas es la\nmisma que necesita papel rayado para escribirse o que aprieta desde abajo el\ntubo de dentífrico.\n   Pero ella no estaría ahora en el puente. Su fina cara de translúcida piel se\nasomaría a viejos portales en el ghetto del Marais, quizá estuviera charlando con\nuna vendedora de papas fritas o comiendo una salchicha caliente en el boulevard\nde Sébastopol. De todas maneras subí hasta el puente, y la Maga no estaba.\nAhora la Maga no estaba en mi camino, y aunque conocíamos nuestros\ndomicilios, cada hueco de nuestras dos habitaciones de falsos estudiantes en\nParís, cada tarjeta postal abriendo una ventanita Braque o Ghirlandaio o Max\nErnst contra las molduras baratas y los papeles chillones, aun así no nos\nbuscaríamos en nuestras casas. Preferíamos encontrarnos en el puente, en la\nterraza de un café, en un cine-club o agachados junto a un gato en cualquier\npatio del barrio latino. Andábamos sin buscarnos pero sabiendo que andábamos\n                                            6\n"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
 [6] "                                                                                   1\npara encontrarnos. Oh Maga, en cada mujer parecida a vos se agolpaba como un\nsilencio ensordecedor, una pausa filosa y cristalina que acababa por derrumbarse\ntristemente, como un paraguas mojado que se cierra. Justamente un paraguas,\nMaga, te acordarías quizá de aquel paraguas viejo que sacrificamos en un\nbarranco del Parc Montsouris, un atardecer helado de marzo. Lo tiramos porque\nlo habías encontrado en la Place de la Concorde, ya un poco roto, y lo usaste\nmuchísimo, sobre todo para meterlo en las costillas de la gente en el metro y en\nlos autobuses, siempre torpe y distraída y pensando en pájaros pintos o en un\ndibujito que hacían dos moscas en el techo del coche, y aquella tarde cayó un\nchaparrón y vos quisiste abrir orgullosa tu paraguas cuando entrábamos en el\nparque, y en tu mano se armó una catástrofe de relámpagos fríos y nubes negras,\njirones de tela destrozada cayendo entre destellos de varillas desencajadas, y nos\nreíamos como locos mientras nos empapábamos, pensando que un paraguas\nencontrado en una plaza debía morir dignamente en un parque, no podía entrar\nen el ciclo innoble del tacho de basura o del cordón de la vereda; entonces yo lo\narrollé lo mejor posible, lo llevamos hasta lo alto del parque, cerca del puentecito\nsobre el ferrocarril, y desde allí lo tiré con todas mis fuerzas al fondo de la\nbarranca de césped mojado mientras vos proferías un grito donde vagamente\ncreí reconocer una imprecación de walkyria. Y en el fondo del barranco se\nhundió como un barco que sucumbe al agua verde, al agua verde y procelosa, a\nla mer qui est plus félonesse en été qu’en hiver, a la ola pérfida, Maga, según\nenumeraciones que detallamos largo rato, enamorados de Joinville y del parque,\nabrazados y semejantes a árboles mojados o a actores de cine de alguna pésima\npelícula húngara. Y quedó entre el pasto, mínimo y negro, como un insecto\npisoteado. Y no se movía, ninguno de sus resortes se estiraba como antes.\nTerminado. Se acabó. Oh Maga, y no estábamos contentos.\n    ¿Qué venía yo a hacer al Pont des Arts? Me parece que ese jueves de\ndiciembre tenía pensado cruzar a la orilla derecha y beber vino en el cafecito de\nla rue des Lombards donde madame Léonie me mira la palma de la mano y me\n                                           7\n"                        
 [7] "                                                                                 1\nanuncia viajes y sorpresas. Nunca te llevé a que madame Léonie te mirara la\npalma de la mano, a lo mejor tuve miedo de que leyera en tu mano alguna\nverdad sobre mí, porque fuiste siempre un espejo terrible, una espantosa\nmáquina de repeticiones, y lo que llamamos amarnos fue quizá que yo estaba de\npie delante de vos, con una flor amarilla en la mano, y vos sostenías dos velas\nverdes y el tiempo soplaba contra nuestras caras una lenta lluvia de renuncias y\ndespedidas y tickets de metro. De manera que nunca te llevé a que madame\nLéonie, Maga; y sé, porque me lo dijiste, que a vos no te gustaba que yo te viese\nentrar en la pequeña librería de la rue de Verneuil, donde un anciano agobiado\nhace miles de fichas y sabe todo lo que puede saberse sobre historiografía. Ibas\nallí a jugar con un gato, y el viejo te dejaba entrar y no te hacía preguntas,\ncontento de que á veces le alcanzaras algún libro de los estantes más altos. Y te\ncalentabas en su estufa de gran caño negro y no te gustaba que yo supiera que\nibas a ponerte al lado de esa estufa. Pero todo esto había que decirlo en su\nmomento, sólo que era difícil precisar el momento de una cosa, y aún ahora,\nacodado en el puente, viendo pasar una pinaza color borravino, hermosísima\ncomo una gran cucaracha reluciente de limpieza, con una mujer de delantal\nblanco que colgaba ropa en un alambre de la proa, mirando sus ventanillas\npintadas de verde con cortinas Hansel y Gretel, aún ahora, Maga, me preguntaba\nsi este rodeo tenía sentido, ya que para llegar a la rue des Lombards me hubiera\nconvenido más cruzar el Pont Saint-Michel y el Pont au Change. Pero si hubieras\nestado ahí esa noche, como tantas otras veces, yo habría sabido que el rodeo tenía\nun sentido, y ahora en cambio envilecía mi fracaso llamándolo rodeo. Era\ncuestión, después de subirme el cuello de la canadiense, de seguir por los\nmuelles hasta entrar en esa zona de grandes tiendas que se acaba en el Chátelet,\npasar bajo la sombra violeta de la Tour Saint-Jacques y subir por mi calle\npensando en que no te había encontrado y en madame Léonie.\n    Sé que un día llegué a París, sé que estuve un tiempo viviendo de prestado,\nhaciendo lo que otros hacen y viendo lo que otros ven. Sé que salías de un café\n                                           8\n"                 
 [8] "                                                                                1\nde la rue du Cherche-Midi y que nos hablamos. Esa tarde todo anduvo mal,\nporque mis costumbres argentinas me prohibían cruzar continuamente de una\nvereda a otra para mirar las cosas más insignificantes en las vitrinas apenas\niluminadas de unas calles que ya no recuerdo. Entonces te seguía de mala gana,\nencontrándote petulante y malcriada, hasta que te cansaste de no estar cansada y\nnos metimos en un café del Boul’Mich’ y de golpe, entre dos medialunas, me\ncontaste un gran pedazo de tu vida Cómo podía yo sospechar que aquello que\nparecía tan mentira era verdadero, un Figari con violetas de anochecer, con caras\nlívidas, con hambre y golpes en los rincones. Más tarde te creí, más tarde hubo\nrazones, hubo madame Léonie que mirándome la mano que había dormido con\ntus senos me repitió casi tus mismas palabras. «Ella sufre en alguna parte.\nSiempre ha sufrido. Es muy alegre, adora el amarillo, su pájaro es el mirlo, su\nhora la noche, su puente el Pont des Arts.» (Una pinaza color borravino, Maga, y\npor qué no nos habremos ido en ella cuando todavía era tiempo.)\n    Y mirá que apenas nos conocíamos y ya la vida urdía lo necesario para\ndesencontrarnos minuciosamente. Como no sabías disimular me di cuenta en\nseguida de que para verte como yo quería era necesario empezar por cerrar los\nojos, y entonces primero cosas como estrellas amarillas (moviéndose en una jalea\nde terciopelo), luego saltos rojos del humor y de las horas, ingreso paulatino en\nun mundo-Maga que era la torpeza y la confusión pero también helechos con la\nfirma de la araña Klee, el circo Miró, los espejos de ceniza Vieira da Silva, un\nmundo donde te movías como un caballo de ajedrez que se moviera como una\ntorre que se moviera como un alfil. Y entonces en esos días íbamos a los\ncineclubs a ver películas mudas, porque yo con mi cultura, no es cierto, y vos\npobrecita no entendías absolutamente nada de esa estridencia amarilla convulsa\nprevia a tu nacimiento, esa emulsión estriada donde corrían los muertos; pero de\nrepente pasaba por ahí Harold Lloyd y entonces te sacudías el agua del sueño y\nal final te convencías de que todo había estado muy bien, y que Pabst y que Fritz\nLang. Me hartabas un poco con tu manía de perfección, con tus zapatos rotos,\n                                          9\n"                
 [9] "                                                                                 1\ncon tu negativa a aceptar lo aceptable. Comíamos hamburgers en el Carrefour de\nl’Odéon, y nos íbamos en bicicleta a Montparnasse, a cualquier hotel, a cualquier\nalmohada. Pero otras veces seguíamos hasta la Porte d’Orléans, conocíamos cada\nvez mejor la zona de terrenos baldíos que hay más allá del Boulevard Jourdan,\ndonde a veces a medianoche se reunían los del Club de la Serpiente para hablar\ncon un vidente ciego, paradoja estimulante. Dejábamos las bicicletas en la calle y\nnos internábamos de a poco, parándonos a mirar el cielo porque ésa es una de las\npocas zonas de París donde el cielo vale más que la tierra. Sentados en un\nmontón de basuras fumábamos un rato, y la Maga me acariciaba el pelo o\ncanturreaba melodías ni siquiera inventadas, melopeas absurdas cortadas por\nsuspiros o recuerdos. Yo aprovechaba para pensar en cosas inútiles, método que\nhabía empezado a practicar años atrás en un hospital y que cada vez me parecía\nmás fecundo y necesario. Con un enorme esfuerzo, reuniendo imágenes\nauxiliares, pensando en olores y caras, conseguía extraer de la nada un par de\nzapatos marrones que había usado en Olavarría en 1940. Tenían tacos de goma,\nsuelas muy finas, y cuando llovía me entraba el agua hasta el alma. Con ese par\nde zapatos en la mano del recuerdo, el resto venía solo: la cara de doña Manuela,\npor ejemplo, o el poeta Ernesto Morroni. Pero los rechazaba porque el juego\nconsistía en recobrar tan sólo lo insignificante, lo inostentoso, lo perecido.\nTemblando de no ser capaz de acordarme, atacado por la polilla que propone la\nprórroga, imbécil a fuerza de besar el tiempo, terminaba por ver al lado de los\nzapatos una latita de Té Sol que mi madre me había dado en Buenos Aires. Y la\ncucharita para el té, cuchara-ratonera donde las lauchitas negras se quemaban\nvivas en la taza de agua lanzando burbujas chirriantes. Convencido de que el\nrecuerdo lo guarda todo y no solamente a las Albertinas y a las grandes\nefemérides del corazón y los riñones, me obstinaba en reconstruir el contenido de\nmi mesa de trabajo en Floresta, la cara de una muchacha irrecordable llamada\nGekrepten, la cantidad de plumas cucharita que había en mi caja de útiles de\nquinto grado, y acababa temblando de tal manera y desesperándome (porque\n                                         10\n"
[10] "                                                                                 1\nnunca he podido acordarme de esas plumas cucharita, sé que estaban en la caja\nde útiles, en un compartimento especial, pero no me acuerdo de cuántas eran ni\npuedo precisar el momento justo en que debieron ser dos o seis), hasta que la\nMaga, besándome y echándome en la cara el humo del cigarrillo y su aliento\ncaliente, me recobraba y nos reíamos, empezábamos a andar de nuevo entre los\nmontones de basura en busca de los del Club. Ya para entonces me había dado\ncuenta de que buscar era mi signo, emblema de los que salen de noche sin\npropósito fijo, razón de los matadores de brújulas. Con la Maga hablábamos de\npatafísica hasta cansarnos, porque a ella también le ocurría (y nuestro encuentro\nera eso, y tantas cosas oscuras como el fósforo) caer de continuo en las\nexcepciones, verse metida en casillas que no eran las de la gente, y esto sin\ndespreciar a nadie, sin creernos Maldorores en liquidación ni Melmoths\nprivilegiadamente errantes. No me parece que la luciérnaga extraiga mayor\nsuficiencia del hecho incontrovertible de que es una de las maravillas más\nfenomenales de este circo, y sin embargo basta suponerle una conciencia para\ncomprender que cada vez que se le encandila la barriguita el bicho de luz debe\nsentir como una cosquilla de privilegio. De la misma manera a la Maga le\nencantaban los líos inverosímiles en que andaba metida siempre por causa del\nfracaso de las leyes en su vida. Era de las que rompen los puentes con sólo\ncruzarlos, o se acuerdan llorando a gritos de haber visto en una vitrina el décimo\nde lotería que acaba de ganar cinco millones. Por mi parte ya me había\nacostumbrado a que me pasaran cosas modestamente excepcionales, y no\nencontraba demasiado horrible que al entrar en un cuarto a oscuras para recoger\nun álbum de discos, sintiera bullir en la palma de la mano el cuerpo vivo de un\nciempiés gigante que había elegido dormir en el lomo del álbum. Eso, y\nencontrar grandes pelusas grises o verdes dentro de un paquete de cigarrillos, u\noír el silbato de una locomotora exactamente en el momento y el tono necesarios\npara incorporarse ex officio a un pasaje de una sinfonía de Ludwig van, o entrar\na una pissotière de la rue de Médicis y ver a un hombre que orinaba\n                                          11\n"                                        </code></pre>
</div>
</div>
<p>parece que tenemos un vector de characteres por página aunque el número de página está en desface -1, seguramente porque la página inicial del título no lleva número.</p>
<p>Armemos data-frame</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>my_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">text =</span> my_pdf) <span class="sc">%&gt;%</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Agregamos número de página ya que tiene cierta relevancia para el análisis</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">page =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(my_pdf))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="si-queremos-una-fila-por-linea-en-el-texto" class="level3">
<h3 class="anchored" data-anchor-id="si-queremos-una-fila-por-linea-en-el-texto">Si queremos una fila por linea en el texto</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>my_data <span class="ot">&lt;-</span> my_data <span class="sc">%&gt;%</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">text =</span> stringr<span class="sc">::</span><span class="fu">str_split</span>(text,<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>vemos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>my_data <span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n=</span><span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 100 × 2
   text                                                     page
   &lt;chr&gt;                                                   &lt;int&gt;
 1 "Julio Cortazar"                                            1
 2 "  Rayuela"                                                 1
 3 ""                                                          1
 4 "Y animado de la esperanza de ser particularmente útil"     2
 5 "a la juventud, y de contribuir a la reforma de las"        2
 6 "costumbres en general, he formado la presente"             2
 7 "colección de máximas, consejos y preceptos, que son"       2
 8 "la base de aquella moral universal, que es tan"            2
 9 "proporcionada a la felicidad espiritual y temporal de"     2
10 "todos los hombres de cualquiera edad, estado y"            2
# ℹ 90 more rows</code></pre>
</div>
</div>
</section>
</section>
<section id="cómo-sacar-los-capítulos" class="level2">
<h2 class="anchored" data-anchor-id="cómo-sacar-los-capítulos">Cómo sacar los capítulos</h2>
<pre><code>[5] "                                                                                    1\n                                                                                   1\n   ¿Encontraría a la Maga?</code></pre>
<p>aparentemente los capítulos (el número del mismo) está indicado en las primeras dos lineas de cada bloque y arranca en la página 5. Podemos valernos de ello para asignar el número correspondiente.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>my_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">text =</span> my_pdf)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>my_data<span class="sc">$</span>capitulo <span class="ot">&lt;-</span> <span class="fu">map_int</span>(my_data<span class="sc">$</span>text,<span class="sc">~</span>{</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_extract</span>(.x,<span class="st">"</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">n"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>()</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(my_data<span class="sc">$</span>capitulo, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 389</code></pre>
</div>
</div>
<p>Hacemos un chequeo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(my_data<span class="sc">$</span>capitulo, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 389</code></pre>
</div>
</div>
<p>OK hay un problema</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>my_data<span class="sc">$</span>capitulo[<span class="dv">376</span><span class="sc">:</span><span class="dv">401</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  56  56  56  56  56  56  56  56  56  56  56  56 389  57  57  58  58  59  60
[20]  61  61  62  62  62  63  64</code></pre>
</div>
</div>
<p>Al final del capitulo 56/principio del 57 especificamente:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span>(my_data<span class="sc">$</span>capitulo<span class="sc">==</span><span class="dv">389</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 388</code></pre>
</div>
</div>
<p>En la página 388.</p>
<p>Veamos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>my_data<span class="sc">$</span>text[<span class="dv">388</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "DE OTROS LADOS\n (Capítulos prescindibles)\n           389\n"</code></pre>
</div>
</div>
<p>Es una página sin capítulo que indica una sección. Tenemos dos opciones:<br>
</p>
<ol type="1">
<li>Refinar nuestro regex</li>
<li>Modificarlo a mano.</li>
</ol>
<p>La opción 2 tiene la desventaja de no ser <em>reproducible</em> (p.e. si se usa otra edición del mismo texto)</p>
<p>El regex tiene la opción ^ para indicar inicio del vector de characteres. Para asegurar que esté en esa posición podemos usar <code>str_trim</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>my_data<span class="sc">$</span>capitulo <span class="ot">&lt;-</span> <span class="fu">map_int</span>(my_data<span class="sc">$</span>text,<span class="sc">~</span>{</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_extract</span>(<span class="fu">str_trim</span>(.x),<span class="st">"^</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">n"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>()</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Verificamos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>my_data<span class="sc">$</span>capitulo <span class="sc">%&gt;%</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">max</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 155</code></pre>
</div>
</div>
<p>y</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>my_data<span class="sc">$</span>capitulo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1]  NA  NA  NA  NA   1   1   1   1   1   1   1   1   1   2   2   2   2   2
 [19]   2   3   3   3   3   3   3   4   4   4   4   4   4   5   5   5   5   6
 [37]   6   7   8   8   9   9   9   9   9  10  10  11  11  11  12  12  12  12
 [55]  12  12  13  13  13  14  14  14  15  15  15  15  15  15  16  16  16  16
 [73]  17  17  17  17  17  17  18  18  18  18  18  19  19  19  19  19  20  20
 [91]  20  20  20  20  20  20  20  20  20  20  20  21  21  21  21  21  21  22
[109]  22  22  22  23  23  23  23  23  23  23  23  23  23  23  23  23  23  23
[127]  23  23  23  23  23  23  23  23  23  23  23  23  23  24  24  24  24  24
[145]  25  25  25  26  26  26  26  27  27  27  27  28  28  28  28  28  28  28
[163]  28  28  28  28  28  28  28  28  28  28  28  28  28  28  28  28  28  28
[181]  28  28  28  28  28  28  28  28  28  28  28  28  29  29  29  29  29  29
[199]  30  30  31  31  31  31  31  31  32  32  32  32  33  33  34  34  34  34
[217]  34  34  34  34  34  34  35  35  35  35  36  36  36  36  36  36  36  36
[235]  36  36  36  36  36  36  36  36  36  37  37  37  37  37  38  38  38  39
[253]  39  40  40  40  40  40  41  41  41  41  41  41  41  41  41  41  41  41
[271]  41  41  41  41  41  41  41  41  41  41  41  41  41  41  41  41  41  41
[289]  41  41  41  41  42  42  42  43  43  43  43  44  44  44  44  44  45  45
[307]  45  45  46  46  46  46  46  46  46  47  47  47  47  47  48  48  48  48
[325]  48  48  49  49  49  49  50  50  50  50  51  51  51  51  51  51  51  51
[343]  52  52  53  53  53  53  54  54  54  54  54  54  54  54  54  54  55  55
[361]  55  55  56  56  56  56  56  56  56  56  56  56  56  56  56  56  56  56
[379]  56  56  56  56  56  56  56  56  56  NA  57  57  58  58  59  60  61  61
[397]  62  62  62  63  64  64  64  65  65  66  67  67  68  69  69  70  71  71
[415]  71  71  71  72  72  73  73  73  74  74  74  75  76  76  77  77  78  78
[433]  78  78  79  79  79  80  80  81  82  83  83  84  84  84  84  85  86  86
[451]  87  88  88  89  89  89  89  90  90  90  90  90  91  92  92  92  92  93
[469]  93  93  93  94  95  95  95  96  96  96  96  96  97  97  98  98  99  99
[487]  99  99  99  99  99  99  99  99  99  99 100 100 100 100 100 101 101 102
[505] 102 103 103 104 105 106 107 108 108 108 108 108 108 108 109 109 110 111
[523] 111 111 111 112 112 113 113 114 115 116 116 117 118 119 120 120 121 122
[541] 122 122 123 123 123 124 124 125 125 125 126 127 127 128 129 129 129 129
[559] 129 129 129 129 130 131 132 132 133 133 133 133 133 133 133 133 133 133
[577] 133 133 133 133 133 134 134 135 136 137 138 138 138 139 139 140 140 141
[595] 141 141 141 142 142 142 143 143 143 144 144 145 146 147 148 149 150 151
[613] 152 153 154 154 154 154 154 154 154 155 155 155 155 155 155</code></pre>
</div>
</div>
<p><strong>QED</strong></p>
</section>
<section id="sacar-los-hipervínculos." class="level2">
<h2 class="anchored" data-anchor-id="sacar-los-hipervínculos.">Sacar los hipervínculos.</h2>
<p>Están en formato (-131) así que podemos usar el regex (?&lt;=\(\-)(\d+)(?=\))</p>
<p>Ejemplo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_extract</span>(my_data<span class="sc">$</span>text[<span class="dv">393</span>], <span class="st">"(?&lt;=</span><span class="sc">\\</span><span class="st">(</span><span class="sc">\\</span><span class="st">-)(</span><span class="sc">\\</span><span class="st">d+)(?=</span><span class="sc">\\</span><span class="st">))"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "41"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>my_data<span class="sc">$</span>vinculo <span class="ot">&lt;-</span> <span class="fu">map_int</span>(my_data<span class="sc">$</span>text,<span class="sc">~</span>{</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_extract</span>(.x, <span class="st">"(?&lt;=</span><span class="sc">\\</span><span class="st">(</span><span class="sc">\\</span><span class="st">-)(</span><span class="sc">\\</span><span class="st">d+)(?=</span><span class="sc">\\</span><span class="st">))"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>()</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="gardamos-datos" class="level2">
<h2 class="anchored" data-anchor-id="gardamos-datos">Gardamos datos</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_rds</span>(my_data,here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data/rayuela-procesado.rds"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>